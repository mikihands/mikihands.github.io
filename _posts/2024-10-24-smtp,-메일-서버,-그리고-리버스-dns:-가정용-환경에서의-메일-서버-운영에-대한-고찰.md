---
layout: post
title: "SMTP, 메일 서버, 그리고 리버스 DNS: 가정용 환경에서의 메일 서버 운영에 대한 고찰"
date: 2024-10-24 00:30:00 +09:00
categories: Linux
tags: Mail-server
---

최근에 메일 서버와 SMTP, 그리고 그에 연관된 여러 가지 기술적 개념들에 대해 깊이 있게 이해하게 됐다. 메일 서버를 운영하는 데 필요한 다양한 포트의 역할, 보안 방식을 포함해, 가정용 IP와 기업용 IP 간의 차이, 그리고 SMTP 릴레이 서버의 필요성에 대해 정리해봤다.

### 1. 메일 서버와 포트들의 역할

메일 서버는 주로 **SMTP (Simple Mail Transfer Protocol)**를 통해 메일을 전송한다. 메일 전송에는 여러 포트가 사용되는데, 각 포트는 역할과 보안성 측면에서 차이가 있다.

- **25번 포트 (SMTP)**: 메일 서버 간의 통신을 위해 사용되는 표준 포트다. 주로 서버 대 서버 간에 메일을 전달할 때 사용되며, 기본적으로 암호화되지 않은 상태에서 통신이 이루어진다. 따라서 25번 포트는 **서버 간의 신뢰성**을 전제로 사용된다.

- **587번 포트 (SMTP Submission)**: 메일 클라이언트(예: 썬더버드)가 메일 서버에 메일을 제출할 때 사용된다. 이 포트는 **사용자 인증**과 **TLS/SSL 암호화**를 요구하여 메일 전송 시 보안성을 강화한다. 마치 웹에서 **HTTP**와 **HTTPS**가 각각 80번과 443번 포트를 사용하는 것처럼, 587번 포트는 메일 전송을 위한 보안된 연결을 의미한다.

### 2. 리버스 DNS의 개념과 역할

**리버스 DNS (Reverse DNS)**는 일반적인 DNS의 역방향 과정이다. 보통 DNS는 도메인 이름을 **IP 주소**로 변환하지만, 리버스 DNS는 **IP 주소를 도메인 이름으로 변환**하는 과정을 의미한다. 메일 서버 간의 신뢰성 평가에서 중요한 역할을 하며, 발신 서버의 IP가 도메인과 일치하는지 확인하는 데 사용된다. 수신 서버는 리버스 DNS를 통해 발신자가 신뢰할 수 있는 서버인지 검증하게 된다.

리버스 DNS가 잘못 설정되었거나 설정되지 않은 경우, 수신 서버는 해당 메일을 **스팸**으로 의심하거나 차단할 수 있다. 이는 메일 서버 간의 통신에서 발신 서버의 신뢰도를 평가하는 중요한 기준이기 때문이다.

### 3. 가정용 IP와 기업용 IP의 차이

**가정용 IP**와 **기업용 IP**는 여러 가지 면에서 차이를 보인다. 기업용 IP는 고정되어 있고 신뢰할 수 있는 도메인과 리버스 DNS 설정이 잘 되어 있는 반면, 가정용 IP는 주로 **유동 IP**이며, 리버스 DNS 설정이 되어 있지 않은 경우가 많다. 이런 이유로, 가정용 IP에서 메일을 발송할 때는 수신 메일 서버가 해당 IP를 신뢰하지 않을 수 있다.

또한, 많은 인터넷 서비스 제공자(ISP)는 **스팸 방지**를 위해 가정용 네트워크에서 **25번 포트**를 차단한다. 이는 가정용 네트워크가 직접 메일 서버로서 기능하는 것을 방지하고, 스팸 메일 발송을 막기 위한 조치다.

### 4. SMTP 릴레이 서버의 필요성

가정용 네트워크에서 메일 서버를 운영하려면, **SMTP 릴레이 서버**가 필요하다. 가정용 IP에서는 25번 포트를 통해 직접 수신 메일 서버로 메일을 보낼 수 없으므로, 인증된 SMTP 릴레이 서버를 거쳐야만 메일이 발송된다. 이 릴레이 서버는 발신자의 메일을 수신 서버로 안전하게 전달하는 역할을 하며, **Gmail**, **SendGrid**, **Amazon SES**와 같은 서비스들이 SMTP 릴레이 역할을 수행한다.

현재 나는 **Gmail**을 SMTP 릴레이 서버로 사용하고 있다. 이렇게 하면 가정용 네트워크에서 메일을 발송할 때 신뢰할 수 있는 릴레이 서버를 통해 메일을 보낼 수 있기 때문에, 수신 측에서 메일이 스팸으로 차단되지 않고 정상적으로 처리된다.

### 5. 메일 서버 운영의 고찰

이번 고찰을 통해 GCP에서 메일 서버를 운영하든, 내 개인 서버인 라즈베리 파이에서 운영하든, 현재 상황에서는 결국 25번 포트를 사용할 수 없으니 **SMTP 릴레이 서버**가 필요하다는 사실을 깨달았다. 현재로서는 Gmail이 그 역할을 해주고 있으므로, 메일 서버를 이전하는 것이 큰 의미가 없다는 결론을 내렸다. 만약 ISP와 계약하여 **기업용 IP**를 사용할 수 있다면, 직접 25번 포트를 통해 메일을 전송할 수 있을 것이다. 그리고 메일 클라이언트를 넘어서 직접 25번 포트를 이용해 메일 서버를 운영하려면, 25번 포트 통신에 대해 **SPF, DKIM, DMARC** 같은 보안 검증 단계도 구축해야 할 것이다. 여러모로 봤을 때 현재 상태에서는 **SMTP 릴레이 서버**를 통한 메일 발송이 가장 현실적이고 안정적인 방법인 것 같다.

### 마무리하며

이번에 SMTP, 메일 서버의 포트와 보안 방식, 그리고 리버스 DNS와 SMTP 릴레이 서버의 개념을 다시 한 번 정리하면서, 메일 서버 운영에서 보안과 신뢰성이 얼마나 중요한지 깨닫게 됐다. 특히 가정용 IP 환경에서는 SMTP 릴레이 서버의 사용이 필수적이며, 메일 전송의 신뢰성을 보장하는 데 큰 역할을 한다는 점을 이해하게 됐다. 앞으로 메일 서버 운영을 더 안정적이고 신뢰성 있게 하기 위해 추가적인 설정이나 방법을 고려해 볼 예정이다.