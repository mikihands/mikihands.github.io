---
layout: post
title:  "Linux 시스템의 파일소유권과 권한 #1"
date:   2024-07-23 17:42:00 +0900
categories: Linux
tags: Linux 명령어
---

## 파일 소유권의 개념과 관리방법을 알아야 하는 이유

Linux 시스템을 혼자 자신의 PC에서만 사용할 때는 파일과 디렉토리의 소유권과 권한 관리가 중요한지 느끼지 못할 수도 있습니다. 그러나, 서비스를 만들어 베포하게 되면 그 때부터는 파일의 소유권과 권한관리 때문에 고생을 한 기억이 있습니다. 보안따위는 신경안쓰고 서비스를 베포하면 모를까, 해커들이 무차별 적으로 공격을 하는 요즘 세상에서 보안을 신경 쓰지 않을 수 없습니다. 

파일의 소유권과 권한관리리 없이 단 하나의 사용자, 혹은 root 로 서비스를 가동하게 되면 그만큼 보안에 취약해집니다. 하나가 뚫리면 모든 서비스와 심지어 서버 VM 까지 털릴 수 있기 때문이지요. 

하나의 서비스를 세상에 베포하다보면 보통 Docker로 패키징을 하여 배포하는 것이 보통입니다. Docker 내부에는 서비스의 코드도 들어있지만, DB나 서버프로그램을 포함시키기도 합니다. 그리고 때로는 일부의 정적파일을 호스트 시스템과 연결하여 Bind Voulume Mount를 하기도 합니다. 

이런 경우, 모든 객체를 동일한 소유자로 하고 소유자에게 **700(읽기+쓰기+실행)***의 권한을 주거나 모든 권한을 가진 `root` 로 실행을 해서 서비스를 쉽게 운영할 수도 있겠으나. 만약 공격자에게 아이디가 비번이 뚫리면 상상하기도 싫은 일이 벌어지겠죠. 

따라서 저는 모든 객체를 다른 사용자로 설정을 하고 각 사용자들이 서비스든, DB든, 서버프로그램이든 운영하게 만들고 저는 저만의 유저명으로 호스트 시스템을 운영하고 지휘합니다. 

이러한 방법이 혹시 발생할 수 있는 상황에 피해를 최소화하고 보안을 높일 수 있게 되겠지요. 
보통 Docker 컨테이너 들은 root 사용자가 Default로 되어 있으므로 공격자들은 root로 접근하려하겠지만, 실제는 각각 다른 사용자 ID와 PW로 감춰진 채 `코드프레임워크`와, `데이터베이스`와 `서버`와 `호스트`가 서로 최소한의 권한만 나눠가지면서 협업을 통해 서비스를 제공하고 있으니까요. 

따라서 Linux의 파일과 디렉토리의 소유권과 사용권한을 이해하고 이에 맞게 운영하는 것은 보안의 첫걸음이라고 할 수 있겠습니다. 

아래에 이와 관련된 Linux 명령어들을 정리해나가볼까 합니다. 내용이 길어질 테니 여러편에 걸쳐서 글이 작성될 수도 있겠네요. 

# `chown`의 사용설명서



 아래는 `chown` 명령어의 사용 설명을 한국어로 번역한 내용입니다:

```lua
사용법: chown [옵션]... [소유자][:[그룹]] 파일...
    또는: chown [옵션]... --reference=참조파일 파일...
각 파일의 소유자 및/또는 그룹을 소유자 및/또는 그룹으로 변경합니다.
--reference 옵션을 사용하면 각 파일의 소유자와 그룹을 참조파일의 소유자와 그룹으로 변경합니다.

옵션:
  -c, --changes          변경이 있을 때만 보고 (상세 출력)
  -f, --silent, --quiet  대부분의 오류 메시지를 숨김
  -v, --verbose          처리된 모든 파일에 대해 진단 메시지를 출력
      --dereference      각 심볼릭 링크의 참조 대상으로 작용 (기본값)
  -h, --no-dereference   심볼릭 링크 자체에 작용 (심볼릭 링크의 소유권을 변경할 수 있는 시스템에서만 유용)
      --from=현재소유자:현재그룹
                         파일의 현재 소유자 및/또는 그룹이 지정된 값과 일치할 경우에만 변경합니다.
                         어느 하나라도 생략될 수 있으며, 생략된 속성에 대해서는 일치 여부를 확인하지 않습니다.
      --no-preserve-root 루트(/)를 특별히 취급하지 않음 (기본값)
      --preserve-root    루트(/)에서 재귀적으로 작동하지 않음
      --reference=참조파일  소유자:그룹 값을 지정하는 대신 참조파일의 소유자 및 그룹을 사용
  -R, --recursive        파일과 디렉토리에 대해 재귀적으로 작동

-R 옵션이 지정된 경우 디렉토리 계층 구조를 어떻게 탐색할지를 수정하는 다음 옵션들:
  -H                     명령 줄 인자가 디렉토리로의 심볼릭 링크인 경우, 해당 링크를 탐색
  -L                     디렉토리로의 모든 심볼릭 링크를 탐색
  -P                     심볼릭 링크를 전혀 탐색하지 않음 (기본값)

      --help     도움말을 표시하고 종료
      --version  버전 정보를 출력하고 종료

소유자가 지정되지 않으면 변경되지 않습니다. 그룹이 지정되지 않으면 로그인 그룹으로 변경됩니다.

예시:
  chown root /u        /u의 소유자를 "root"로 변경
  chown root:staff /u  /u의 소유자를 "root"로, 그룹을 "staff"로 변경
  chown -hR root /u    /u와 하위 파일들의 소유자를 "root"로 변경
```

이 번역은 `chown` 명령어를 쉽게 이해하고 사용할 수 있도록 도와줄 것입니다.



# `chmod`의 모드에 사용되는 8진수의 의미

`chmod` 명령어에서 파일 또는 디렉토리의 권한을 설정할 때 8진수를 사용하는데, 각 숫자는 파일 권한을 나타냅니다. 이 권한은 읽기(read), 쓰기(write), 실행(execute)의 조합으로 이루어져 있습니다. 8진수는 0에서 7까지의 숫자로 이루어지며, 각 숫자는 권한의 조합을 나타냅니다.

### 기본 권한과 숫자

각 숫자는 3비트로 이루어져 있으며, 각 비트는 특정 권한을 나타냅니다:

- **읽기 (read)**: 4
- **쓰기 (write)**: 2
- **실행 (execute)**: 1

이 권한들을 더하여 각 숫자를 만듭니다:

- **0**: 아무 권한 없음 (---)
- **1**: 실행 권한 (--x)
- **2**: 쓰기 권한 (-w-)
- **3**: 쓰기 + 실행 권한 (-wx)
- **4**: 읽기 권한 (r--)
- **5**: 읽기 + 실행 권한 (r-x)
- **6**: 읽기 + 쓰기 권한 (rw-)
- **7**: 읽기 + 쓰기 + 실행 권한 (rwx)

### 권한 조합

`chmod` 명령어는 세 자리의 8진수를 사용하여 파일 권한을 설정합니다. 각 자리는 사용자 범주에 대한 권한을 나타냅니다:

1. **첫 번째 자리**: 파일 소유자의 권한 (user)
2. **두 번째 자리**: 그룹의 권한 (group)
3. **세 번째 자리**: 다른 모든 사용자의 권한 (others)

예를 들어, `chmod 755` 명령어는 다음과 같은 권한을 설정합니다:

- **7 (rwx)**: 파일 소유자는 읽기, 쓰기, 실행 권한을 가집니다.
- **5 (r-x)**: 그룹은 읽기, 실행 권한을 가집니다.
- **5 (r-x)**: 다른 모든 사용자는 읽기, 실행 권한을 가집니다.

### 예시

- `chmod 644 filename`:
  - 소유자: 읽기, 쓰기 권한 (6, rw-)
  - 그룹: 읽기 권한 (4, r--)
  - 다른 사용자: 읽기 권한 (4, r--)
- `chmod 777 filename`:
  - 소유자: 읽기, 쓰기, 실행 권한 (7, rwx)
  - 그룹: 읽기, 쓰기, 실행 권한 (7, rwx)
  - 다른 사용자: 읽기, 쓰기, 실행 권한 (7, rwx)

이와 같이, `chmod` 명령어에서 8진수는 파일 권한을 설정하는 데 사용되며, 각 숫자는 읽기, 쓰기, 실행 권한의 조합을 나타냅니다.

