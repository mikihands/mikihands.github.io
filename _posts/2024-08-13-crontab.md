---
layout: post
title:  "스케쥴링 작업의 최고 Tool : Crontab을 알아보자"
date:   2024-08-13 21:46:00 +0900
categories: Linux
tags: Linux Crontab
---



## `crontab`이란?

`crontab`은 리눅스 및 유닉스 시스템에서 정기적으로 명령어나 스크립트를 실행할 수 있도록 스케줄링하는 데 사용되는 서비스입니다. `cron` 데몬이 이 스케줄링을 관리하며, 사용자는 `crontab` 파일을 통해 원하는 작업을 설정할 수 있습니다. 이 파일은 특정 시간, 날짜, 주기 등을 지정하여 특정 명령어를 자동으로 실행할 수 있도록 해줍니다.

![image](/assets/images/postings/crontab1.png)



### `crontab` 명령어

- `crontab -e`: 현재 사용자에 대한 `crontab` 파일을 편집합니다. 이 파일에 명령을 추가하여 특정 주기에 작업을 실행할 수 있습니다.
- `crontab -l`: 현재 사용자의 `crontab` 파일 내용을 출력하여 확인합니다.
- `crontab -r`: 현재 사용자의 `crontab` 파일을 삭제합니다.

### `crontab` 파일의 형식

`crontab` 파일은 각 줄에 하나의 작업을 정의하며, 각 줄은 6개의 필드로 구성됩니다. 이 필드들은 다음과 같은 순서로 구성됩니다:

```lua
* * * * * /path/to/command
- - - - -
| | | | |
| | | | +----- 요일 (0 - 7) (일요일이 0 또는 7)
| | | +------- 월 (1 - 12)
| | +--------- 일 (1 - 31)
| +----------- 시 (0 - 23)
+------------- 분 (0 - 59)
```

각 필드는 특정 시간이나 날짜를 지정하며, `*`는 "모든 값"을 의미합니다. 예를 들어, `*`가 들어간 필드는 매 분, 매 시, 매 일, 매 월, 또는 매 요일에 해당 작업을 실행하라는 의미가 됩니다.

### `*/5 * * * * /path/to/myscript.sh`의 의미

이 명령어는 `myscript.sh` 스크립트를 5분마다 실행하라는 의미입니다. 각 필드의 의미를 설명하면 다음과 같습니다:

- `*/5`: 매 5분마다 작업을 실행합니다. `/5`는 "5의 배수에 해당하는 분"을 의미하며, 0분, 5분, 10분, 15분 등 매 5분 간격으로 실행됩니다.
- `*`: 모든 시간을 의미합니다. 즉, 매 시간을 의미합니다 (0시, 1시, 2시, ... 23시).
- `*`: 모든 날을 의미합니다 (1일, 2일, ... 31일).
- `*`: 모든 달을 의미합니다 (1월, 2월, ... 12월).
- `*`: 모든 요일을 의미합니다 (일요일, 월요일, ... 토요일).

따라서, `*/5 * * * * /path/to/myscript.sh`는 매 5분마다 `/path/to/myscript.sh` 스크립트를 실행하라는 명령을 의미합니다.

이 스크립트는 24시간 내내 5분 간격으로 실행되며, 스크립트의 내용을 통해 동적 DNS 업데이트를 주기적으로 수행하게 됩니다.

![image](/assets/images/postings/crontab2.png)



## 활용사례

`crontab`은 특정 시점에 어떤 작업(스크립트나 명령어)을 자동으로 실행하도록 예약하는 데 사용됩니다. 시간 간격뿐만 아니라 특정 날짜와 요일, 시간에 맞춰 실행할 수 있습니다. 몇 가지 `crontab` 설정 예시를 통해 어떻게 다양한 시간 설정을 할 수 있는지 보여드리겠습니다.

### 1. 매 1시간마다 스크립트 실행

```bash
0 * * * * /path/to/script.sh
```

- 매 시간의 0분에 스크립트를 실행합니다 (예: 00:00, 01:00, 02:00, ...).

### 2. 매일 오전 3시에 스크립트 실행

```bash
0 3 * * * /path/to/script.sh
```

- 매일 오전 3시 정각에 스크립트를 실행합니다.

### 3. 매월 1일과 15일 오전 2시에 스크립트 실행

```bash
0 2 1,15 * * /path/to/script.sh
```

- 매달 1일과 15일 오전 2시 정각에 스크립트를 실행합니다.

### 4. 매주 월요일 오전 7시에 스크립트 실행

```bash
0 7 * * 1 /path/to/script.sh
```

- 매주 월요일 오전 7시에 스크립트를 실행합니다.

### 5. 매 분마다 스크립트 실행

```bash
* * * * * /path/to/script.sh
```

- 매 분마다 스크립트를 실행합니다.

### 6. 매 15분마다 스크립트 실행

```bash
*/15 * * * * /path/to/script.sh
```

- 매 15분마다 스크립트를 실행합니다 (예: 00:00, 00:15, 00:30, 00:45, ...).

### 7. 매주 월요일에서 금요일까지, 오전 9시부터 오후 5시까지 매 시간 10분마다 스크립트 실행

```bash
10 9-17 * * 1-5 /path/to/script.sh
```

- 월요일에서 금요일까지, 오전 9시부터 오후 5시까지 매 시간 10분에 스크립트를 실행합니다 (예: 09:10, 10:10, 11:10, ... 17:10).

### 8. 매달 마지막 날 자정에 스크립트 실행

```bash
59 23 28-31 * * [ "$(date +\%d -d tomorrow)" == "01" ] && /path/to/script.sh
```

- 매달 마지막 날 자정에 스크립트를 실행합니다. (이 예제는 쉘 스크립트를 통해 매달 마지막 날을 감지하여 실행하는 방식입니다.)

### 9. 매주 토요일과 일요일 오전 8시 30분에 스크립트 실행

```bash
30 8 * * 6,7 /path/to/script.sh
```

- 매주 토요일과 일요일 오전 8시 30분에 스크립트를 실행합니다.

### 10. 특정 달에만 실행 (예: 매년 6월 1일 자정에 스크립트 실행)

```bash
0 0 1 6 * /path/to/script.sh
```

- 매년 6월 1일 자정(00:00)에 스크립트를 실행합니다.

이와 같이, `crontab`은 매우 다양한 방식으로 스케줄링을 설정할 수 있으며, 시, 분, 일, 월, 요일의 조합을 통해 거의 모든 스케줄을 지정할 수 있습니다.





## 시스템 재부팅과 관련된 사항 

`crontab` 작업은 시스템이 리부트된 후에도 그대로 유지됩니다. `crontab`에 설정된 작업들은 시스템이 다시 시작된 이후에도 자동으로 실행되며, 시스템의 재부팅과는 무관하게 계속해서 작동합니다.

다만, 몇 가지 주의사항이 있습니다:

1. **시스템 리부트 후의 작업 실행**:

   - `crontab`에 설정된 작업들은 시스템이 리부트된 후, 다음에 예정된 시간에 맞춰 실행됩니다. 예를 들어, 매일 오전 3시에 실행되도록 설정된 작업은 시스템이 오전 2시에 재부팅되더라도, 오전 3시에 정상적으로 실행됩니다.

2. **crontab 파일의 유지**:

   - `crontab` 작업은 시스템의 특정 디렉터리(일반적으로 `/var/spool/cron/crontabs/` 또는 `/var/spool/cron/` 디렉터리)에 저장됩니다. 시스템 재부팅 시에도 이 파일들은 유지됩니다.
   - 따라서 시스템이 재부팅되어도 crontab에 설정된 작업들은 사라지지 않습니다.

3. **리부트 후 작업이 안 되는 경우**:

   - 만약 시스템이 재부팅되었을 때 특정 작업이 실행되지 않는 경우, crontab에서 설정된 환경 변수나 필요한 서비스들이 재부팅 후에 제대로 작동하지 않을 수 있으니 확인이 필요합니다.

   `crontab`은 특정 시간에 작업을 실행하도록 예약하는 도구이기 때문에, 시스템이 그 시간에 꺼져 있다가 이후에 켜진 경우, 해당 작업은 실행되지 않고 그냥 패스됩니다.

   예를 들어, 매일 오후 3시에 특정 작업을 실행하도록 설정해 두었는데, 시스템이 오후 2시 30분에 꺼지고 오후 4시에 다시 켜진다면, 오후 3시에 실행되어야 했던 작업은 실행되지 않고 건너뛰게 됩니다.

   

### 이 문제를 해결하기 위한 접근 방법

1. **`@reboot` 옵션 사용**:

   - 시스템이 부팅될 때마다 특정 작업을 실행해야 하는 경우, `@reboot` 옵션을 사용할 수 있습니다:

     ```bash
     @reboot /path/to/script.sh
     ```

   - 그러나 이 옵션은 시스템이 켜질 때마다 작업을 실행하는 것이지, 놓친 작업을 보완하는 것은 아닙니다.

2. **상태 파일 사용**:

   - 스크립트 실행 여부를 기록하는 상태 파일을 사용하여, 시스템이 다시 켜졌을 때 이전에 실행하지 못한 작업을 실행하도록 할 수 있습니다. 예를 들어, 마지막으로 작업이 실행된 시간을 기록해두고, 시스템이 부팅될 때 그 시간이 예약된 시간과 비교하여 작업을 실행할지 판단할 수 있습니다.

3. **Anacron 사용**:

   - 만약 작업이 반드시 실행되어야 한다면 `anacron`을 사용하는 것이 좋습니다. 

     `anacron`은 `cron`과 유사하지만, 시스템이 꺼져있던 경우에도 "놓친" 작업을 실행합니다. 예를 들어, 하루에 한 번 실행해야 하는 작업이 있다면, 시스템이 다시 켜졌을 때 그 작업이 실행되지 않았음을 감지하고 실행할 수 있습니다.

     - Anacron은 `cron`보다 덜 정밀한 스케줄링을 제공하지만, 시스템이 항상 켜져 있지 않은 환경에서 사용하기에 적합합니다.

결론적으로, 일반적인 `crontab`은 시스템이 꺼져 있는 동안의 예약된 작업을 실행하지 않지만, 이러한 상황을 보완하기 위한 여러 가지 방법이 있습니다. 작업의 중요도와 시스템 사용 패턴에 따라 적절한 방법을 선택할 수 있습니다.